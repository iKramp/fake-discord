DROP INDEX IF EXISTS "channel_user_1_id_index";
DROP INDEX IF EXISTS "channel_user_2_id_index";
DROP INDEX IF EXISTS "message_channel_id_index";
DROP TABLE IF EXISTS "messages";
DROP TABLE IF EXISTS "channels";
DROP TABLE IF EXISTS "users";



CREATE TABLE "users" (
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    profile_photo TEXT,
    name VARCHAR(255) UNIQUE
);

CREATE TABLE "channels" (
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    user_1_id BIGINT REFERENCES "users"(id),
    user_2_id BIGINT REFERENCES "users"(id)
);

CREATE INDEX channel_user_1_id_index ON channels(user_1_id);
CREATE INDEX channel_user_2_id_index ON channels(user_2_id);

CREATE TABLE "messages" (
    id BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    user_id BIGINT REFERENCES "users"(id),
    text TEXT,
    date_created BIGINT,
    channel_id BIGINT REFERENCES channels(id)
);

CREATE INDEX message_channel_id_index ON messages(channel_id);

INSERT INTO "users" (name) VALUES ('user1'), ('user2');

INSERT INTO "channels" (user_1_id, user_2_id) VALUES (1, 2);

INSERT INTO messages (user_id, channel_id, text, date_created) VALUES
(1, 1, 'Random text 1', 1687249040000),
(2, 1, 'Random text 2', 1687249040000),
(1, 1, 'Random text 3', 1687249040000),
(2, 1, 'Random text 4', 1687249040000),
(1, 1, 'Random text 5', 1687249040000);